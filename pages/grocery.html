<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      href="../assets/img/hamrogroup3.png"
      type="image/icon type"
    />
    <title>Grocery and Takeout Kitchen</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="../css/header.css" />
    <link rel="stylesheet" href="../css/styles.css" />
    <link rel="stylesheet" href="../css/footer.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #466690;
        --secondary-color: #f8f9fa;
        --accent-color: #34a853;
        --text-color: #202124;
        --border-radius: 8px;
        --box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .search-container {
        max-width: 600px;
        margin: 2rem auto;
        padding: 0 1rem;
      }

      #searchInput {
        width: 100%;
        padding: 1rem;
        border: 2px solid #ddd;
        border-radius: var(--border-radius);
        font-size: 16px;
        transition: border-color 0.3s;
      }

      #searchInput:focus {
        outline: none;
        border-color: var(--primary-color);
      }

      .product-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
      }

      .category-section {
        background-color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        margin-bottom: 2rem;
        overflow: hidden;
        position: relative;
      }

      .category-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        opacity: 0.04;
        z-index: 0;
      }

      .category-section h2 {
        padding: 1rem;
        margin: 0;
        color: white;
        position: relative;
        z-index: 1;
      }

      .subcategory-section {
        padding: 1rem;
      }

      .subcategory-section h3 {
        color: var(--accent-color);
        border-bottom: 2px solid var(--accent-color);
        padding-bottom: 0.5rem;
      }

      .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
      padding: 1rem;
    }

    .product-grid:has(:nth-child(1):last-child),
      .product-grid:has(:nth-child(2):last-child) {
        grid-template-columns: repeat(auto-fit, 250px);
        justify-content: center;
      }

      .product-card {
        background-color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        overflow: hidden;
        transition: transform 0.3s;
        display: flex;
        flex-direction: column;
        justify-content: center;
        min-height: 220px;
        z-index: 5;
        padding: 10px;
      }

      .product-card:hover {
        transform: translateY(-5px);
      }

      .product-card img {
        width: 100%;
        height: 150px;
        object-fit: contain;
      }

      .product-card h4 {
        margin: 0.5rem 0;
        color: var(--primary-color);
      }

      .product-card p {
        margin: 0.5rem 0;
        padding: 0 10px;
      }

      .product-info {
        padding: 1rem;
      }

      .price {
        font-weight: bold;
        color: var(--accent-color);
      }

      @media (max-width: 768px) {
        .product-grid {
          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        }
      }
    </style>
  </head>

  <body>
    <header class="main-header">
      <div class="header-container">
        <div class="headerLogo">
          <img src="../assets/img/hamrogroup3.png" alt="Company Logo" />
          <h1>Hamro Group</h1>
        </div>
        <button class="hamburger" aria-label="Menu">
          &#9776;
        </button>
        <nav class="nav-links">
          <a href="main.html">Home</a>
          <a href="grocery.html">Grocery and Takeout</a>
          <a href="renovation.html">Renovation and Building</a>
          <a href="staffing.html">Staffing </a>
          <a href="consulting.html">Business Consulting</a>
        </nav>
      </div>
    </header>

    <main>
      <!-- View Product Modal -->
      <div id="viewModal" class="modal">
        <div class="modal-content">
          <span class="close" id="viewModalClose">&times;</span>
          <h2 class="modal-title">Product Details</h2>
          <div class="modal-body">
            <img
              id="viewModalImage"
              class="modal-image"
              src=""
              alt="Product Image"
            />
            <p class="modal-text">
              <strong>Name:</strong>
              <span id="viewModalName"></span>
            </p>
            <p class="modal-text">
              <strong>Price:</strong>
              <span id="viewModalPrice"></span>
            </p>
            <p class="modal-text">
              <strong>Category:</strong>
              <span id="viewModalCategory"></span>
            </p>
            <p class="modal-text">
              <strong>SubCategory:</strong>
              <span id="viewModalSubcategory"></span>
            </p>
            <p class="modal-text">
              <strong>Details:</strong>
              <span id="viewModalSmallDetails"></span>
            </p>
            <p class="modal-text">
              <strong>Description:</strong>
              <span id="viewModalDetails"></span>
            </p>
          </div>
        </div>
      </div>
      <div class="search-container">
        <input type="text" id="searchInput" placeholder="Search products..." />
      </div>
      <section class="product-container" id="productContainer"></section>
    </main>

    <footer>
      <div class="footer-wrapper">
        <div class="floating-button">
          <span>Hotline: 6477794246</span>
        </div>
        <div class="company-info">
          <img
            class="footerLogo"
            src="../assets/img/hamrogroup3.png"
            alt="Company Logo"
          />
          <h3>Hamro Group</h3>
          <p>2628 Eglinton Ave E, Scarborough, ON, Canada</p>
          <div class="contact">
            <a href="mailto:dineshsapkota5@gmail.com"
              >dineshsapkota5@gmail.com</a
            >
            <a href="tel:6477794246">6477794246</a>
          </div>
          <div class="social">
            <ul>
              <li>
                <a
                  href="https://www.facebook.com/profile.php?id=61566374786793"
                  target="_blank"
                >
                  <img src="../assets/img/facebook.png" alt="facebookIcon" />
                </a>
              </li>
              <li>
                <!-- <a href="https://instagram.com" target="_blank">
                  <img src="../assets/img/instagram.png" alt="instagramIcon" />
                </a> -->
              </li>
            </ul>
          </div>
        </div>
        <div class="map">
          <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2882.7564524483737!2d-79.25436272488415!3d43.736386047048235!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x89d4ce2eb32e141f%3A0x8a3cfbbdd5fcf38e!2s2628%20Eglinton%20Ave%20E%2C%20Scarborough%2C%20ON%20M1K%202S3!5e0!3m2!1sen!2sca!4v1728353810057!5m2!1sen!2sca"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
          ></iframe>
        </div>
      </div>
    </footer>

    <script defer src="../js/scripts.js"></script>
    <script src="../js/config.js"></script>
    <script>
      const viewModal = document.getElementById("viewModal");
      const viewModalClose = document.getElementById("viewModalClose");

      // Close modal when clicking the close button
      viewModalClose.onclick = function () {
        viewModal.style.display = "none";
      };

      // Close modal when clicking outside of it
      window.onclick = function (event) {
        if (event.target == viewModal) {
          viewModal.style.display = "none";
        }
      };

      function showProductModal(product) {
        if (!product) {
          return;
        }
        if (product.image_path) {
          document.getElementById("viewModalImage").style.display = "block";
        } else {
          document.getElementById("viewModalImage").style.display = "none";
        }
        document.getElementById("viewModalImage").src =
          product.image_path || "";
        document.getElementById("viewModalCategory").textContent =
          product.category;
        document.getElementById("viewModalSubcategory").textContent =
          product.subcategory;
        document.getElementById("viewModalName").textContent = product.name;
        document.getElementById(
          "viewModalPrice"
        ).textContent = `$${product.price}`;
        document.getElementById("viewModalSmallDetails").textContent =
          product.small_details;
        document.getElementById("viewModalDetails").textContent =
          product.details || "No detailed description available.";

        viewModal.style.display = "flex";
      }

      // First, add a <style> tag to the document head for our dynamic styles
      const styleElement = document.createElement("style");
      document.head.appendChild(styleElement);

      // Define a set of visually appealing default colors
      const DEFAULT_COLORS = [
        "#1a73e8", // Google Blue
        // "#ea4335", // Google Red
        // "#fbbc05", // Google Yellow
        "#009688", // Teal
        "#3f51b5", // Indigo
        "#673ab7", // Deep Purple
        "#34a853", // Google Green
        "#795548", // Brown
        "#607d8b", // Blue Grey
        "#e91e63", // Pink
        "#9c27b0", // Purple
        "#2196f3", // Light Blue
        "#00bcd4", // Cyan
        "#4caf50", // Light Green
        "#cddc39", // Lime
        "#ff5722", // Deep Orange
      ];

      let colorIndex = 0;

      function getNextColor() {
        // If we still have default colors, use them
        if (colorIndex < DEFAULT_COLORS.length) {
          return DEFAULT_COLORS[colorIndex++];
        }

        // Otherwise, generate a random color
        return getRandomDarkColor();
      }

      function getRandomDarkColor() {
        const hue = Math.floor(Math.random() * 360);
        return `hsl(${hue}, 70%, 30%)`; // Saturation 70%, Lightness 30% for darker colors
      }

      function applyColors() {
        // Reset color index when reapplying colors
        colorIndex = 0;

        const categorySections = document.querySelectorAll(".category-section");
        let styleRules = "";

        categorySections.forEach((section, index) => {
          const color = getNextColor();
          const categoryId = `category-${index}`;

          // Add a unique identifier to the section
          section.id = categoryId;

          // Add the background color to the h2 element directly
          const h2 = section.querySelector("h2");
          h2.style.backgroundColor = color;

          // Create CSS rule for the semi-transparent background
          styleRules += `
      #${categoryId}::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: ${color};
        opacity: 0.04;
        z-index: 0;
      }
    `;
        });

        // Update the style element with all our new rules
        styleElement.textContent = styleRules;
      }
      async function displayProducts() {
        const response = await fetch(API_CONFIG.getFullUrl("PRODUCTS"), {
          headers: API_CONFIG.getHeaders(),
        });
        const products = await response.json();

        const productContainer = document.getElementById("productContainer");
        const searchInput = document.getElementById("searchInput");

        function renderProducts(filteredProducts) {
          productContainer.innerHTML = ""; // Clear existing content

          if(filteredProducts.length === 0) {
            productContainer.innerHTML = `
              <div class="empty-area">
                <span class="empty-text">No products found</h2>
              </div>
            `;
            return;
          }

          // Group products by category
          const groupedProducts = filteredProducts.reduce((acc, product) => {
            if (!acc[product.category]) {
              acc[product.category] = [];
            }
            acc[product.category].push(product);
            return acc;
          }, {});

          // Create category sections
          for (const [category, items] of Object.entries(groupedProducts)) {
            const categorySection = document.createElement("div");
            categorySection.classList.add("category-section");

            const categoryTitle = document.createElement("h2");
            categoryTitle.textContent = category;
            categorySection.appendChild(categoryTitle);

            const subcategoryContainer = document.createElement("div");
            subcategoryContainer.classList.add("subcategory-container");

            // Group by subcategory
            const groupedSubcategories = items.reduce((acc, item) => {
              if (!acc[item.subcategory]) {
                acc[item.subcategory] = [];
              }
              acc[item.subcategory].push(item);
              return acc;
            }, {});

            // Create subcategory sections
            for (const [subcategory, subItems] of Object.entries(
              groupedSubcategories
            )) {
              const subcategorySection = document.createElement("div");
              subcategorySection.classList.add("subcategory-section");

              const subcategoryTitle = document.createElement("h3");
              subcategoryTitle.textContent = subcategory;
              subcategorySection.appendChild(subcategoryTitle);

              const productGrid = document.createElement("div");
              productGrid.classList.add("product-grid");

              subItems.forEach((product) => {
                const productCard = document.createElement("div");
                productCard.classList.add("product-card");
                productCard.innerHTML = `
                  ${
                    product.image_path
                      ? `<img src="${product.image_path}" alt="${product.name}" loading="lazy"/>`
                      : ""
                  }
                  <h4>${product.name}</h4>
                  <p>${product.small_details}</p>
                  <p>$${product.price}</p>
                `;

                // Add click event to show modal
                productCard.addEventListener("click", () =>
                  showProductModal(product)
                );

                productGrid.appendChild(productCard);
              });

              subcategorySection.appendChild(productGrid);
              subcategoryContainer.appendChild(subcategorySection);
            }

            categorySection.appendChild(subcategoryContainer);
            productContainer.appendChild(categorySection);
          }
          applyColors();
        }

        function filterProducts(searchTerm) {
          return products.filter(
            (product) =>
              product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
              product.small_details
                .toLowerCase()
                .includes(searchTerm.toLowerCase()) ||
              product.category
                .toLowerCase()
                .includes(searchTerm.toLowerCase()) ||
              product.subcategory
                .toLowerCase()
                .includes(searchTerm.toLowerCase())
          );
        }

        searchInput.addEventListener("input", (e) => {
          const filteredProducts = filterProducts(e.target.value);
          renderProducts(filteredProducts);
        });

        // Initial render
        renderProducts(products);
      }

      displayProducts();
    </script>
  </body>
</html>
